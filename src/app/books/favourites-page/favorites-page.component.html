<app-navbar></app-navbar>

<div class="status-filters">
  <button (click)="changeFilter('want-to-read')" 
          [class.active]="filterStatus === 'want-to-read'">
    –•–æ—á—É –ø—Ä–æ—á–∏—Ç–∞—Ç—å
  </button>
  <button (click)="changeFilter('reading')" 
          [class.active]="filterStatus === 'reading'">
    –í –ø—Ä–æ—Ü–µ—Å—Å–µ
  </button>
  <button (click)="changeFilter('completed')" 
          [class.active]="filterStatus === 'completed'">
    –ü—Ä–æ—á–∏—Ç–∞–Ω–æ
  </button>
</div>

<div class="favorites-list">
  <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ –∫–Ω–∏–≥–∏ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ñ–∏–ª—å—Ç—Ä–µ -->
  <div *ngIf="!hasBooksInFilter()" class="no-favorites-message">
    <div class="message-content">
      <div class="icon">üìö</div>
      <h3>–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥</h3>
      <p *ngIf="filterStatus === 'want-to-read'">
        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫–Ω–∏–≥ –≤ —Å–ø–∏—Å–∫–µ "–•–æ—á—É –ø—Ä–æ—á–∏—Ç–∞—Ç—å". 
        –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–∏–≥–∏ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã!
      </p>
      <p *ngIf="filterStatus === 'reading'">
        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫–Ω–∏–≥ –≤ —Å–ø–∏—Å–∫–µ "–í –ø—Ä–æ—Ü–µ—Å—Å–µ". 
        –ù–∞—á–Ω–∏—Ç–µ —á–∏—Ç–∞—Ç—å –∫–Ω–∏–≥—É –∏–∑ "–•–æ—á—É –ø—Ä–æ—á–∏—Ç–∞—Ç—å"!
      </p>
      <p *ngIf="filterStatus === 'completed'">
        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥. 
        –û—Ç–º–µ—Ç—å—Ç–µ –∫–Ω–∏–≥–∏ –∫–∞–∫ "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ", –∫–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—Ç–µ –∏—Ö —á–∏—Ç–∞—Ç—å!
      </p>
      <button class="go-to-books-btn" routerLink="/books">
        –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–Ω–∏–≥–∞–º
      </button>
    </div>
  </div>

  <!-- –ü–æ–∫–∞–∑ –∫–Ω–∏–≥ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å -->
  <div *ngFor="let book of filteredBooks()" 
       class="book-card" 
       [class.editing]="editingBookId === book.id">
    
    <div class="book-header">
      <div class="book-title-author">
        <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–µ -->
        <span class="title clickable-title" (click)="openBookDetails(book)">{{ book.title }}</span> 
        <span class="author">{{ book.author }}</span>
      </div>
      
      <!-- –ö–∞—Ä–∞–Ω–¥–∞—à–∏–∫ —Å–ø—Ä–∞–≤–∞ -->
      <button *ngIf="editingBookId !== (book.id || '')" 
              class="edit-btn" 
              (click)="startEditing(book.id); $event.stopPropagation()">‚úèÔ∏è</button>
    </div>

    <!-- –ó–≤–µ–∑–¥—ã —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
    <div *ngIf="book.status === 'completed'" class="rating-section">
      <span class="rating-label">–û—Ü–µ–Ω–∫–∞:</span>
      <div class="stars">
        <span *ngFor="let star of [1,2,3,4,5]" 
              (click)="rateBook(book, star); $event.stopPropagation()"
              [class.active]="star <= (book.rating || 0)"
              class="star">
          ‚òÖ
        </span>
      </div>
    </div>

    <div *ngIf="editingBookId === book.id" class="edit-panel">
      <div class="form-group">
        <label>–°—Ç–∞—Ç—É—Å:</label>
        <select [(ngModel)]="book.status" (ngModelChange)="changeStatus(book, $event)">
          <option value="want-to-read">–•–æ—á—É –ø—Ä–æ—á–∏—Ç–∞—Ç—å</option>
          <option value="reading">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>
          <option value="completed">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</option>
        </select>
      </div>

      <!-- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—ã–±–æ—Ä –æ—Ü–µ–Ω–∫–∏ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —Å—Ç–∞—Ç—É—Å "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ" -->
      <div *ngIf="book.status === 'completed'" class="form-group">
        <label>–û—Ü–µ–Ω–∫–∞:</label>
        <select [(ngModel)]="book.rating" (ngModelChange)="rateBook(book, $event)" class="rating-select">
          <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</option>
          <option [value]="1">1 ‚òÖ</option>
          <option [value]="2">2 ‚òÖ‚òÖ</option>
          <option [value]="3">3 ‚òÖ‚òÖ‚òÖ</option>
          <option [value]="4">4 ‚òÖ‚òÖ‚òÖ‚òÖ</option>
          <option [value]="5">5 ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</option>
        </select>
      </div>

      <div class="button-group">
        <button class="close-btn" (click)="stopEditing(); $event.stopPropagation()">‚úñÔ∏è –ó–∞–∫—Ä—ã—Ç—å</button>
        <button class="remove-btn" (click)="removeFromFavorites(book); $event.stopPropagation()">
          üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
        </button>
      </div>
    </div>
  </div>
</div>

<app-notification></app-notification>

<app-book-details *ngIf="showBookDetails && selectedBook" 
                  [book]="selectedBook"
                  (close)="closeBookDetails()">
</app-book-details>